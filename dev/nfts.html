<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NFTs in zkSync 1.x</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/docs-test/assets/css/0.styles.ad6f64d8.css" as="style"><link rel="preload" href="/docs-test/assets/js/app.61e6e887.js" as="script"><link rel="preload" href="/docs-test/assets/js/2.25e5da35.js" as="script"><link rel="preload" href="/docs-test/assets/js/12.a9d36d9e.js" as="script"><link rel="prefetch" href="/docs-test/assets/js/10.8e0a6ce5.js"><link rel="prefetch" href="/docs-test/assets/js/11.74eff8ae.js"><link rel="prefetch" href="/docs-test/assets/js/13.f77f1557.js"><link rel="prefetch" href="/docs-test/assets/js/14.343fe5ac.js"><link rel="prefetch" href="/docs-test/assets/js/15.48a15447.js"><link rel="prefetch" href="/docs-test/assets/js/16.bf3ec7da.js"><link rel="prefetch" href="/docs-test/assets/js/17.9a2600e7.js"><link rel="prefetch" href="/docs-test/assets/js/18.74f002f2.js"><link rel="prefetch" href="/docs-test/assets/js/19.3ece5ac5.js"><link rel="prefetch" href="/docs-test/assets/js/20.d4702f03.js"><link rel="prefetch" href="/docs-test/assets/js/21.e923820d.js"><link rel="prefetch" href="/docs-test/assets/js/22.cf64108f.js"><link rel="prefetch" href="/docs-test/assets/js/23.1c2aee73.js"><link rel="prefetch" href="/docs-test/assets/js/24.4fd88f8f.js"><link rel="prefetch" href="/docs-test/assets/js/25.9fe397e7.js"><link rel="prefetch" href="/docs-test/assets/js/26.050db207.js"><link rel="prefetch" href="/docs-test/assets/js/27.c8633de4.js"><link rel="prefetch" href="/docs-test/assets/js/28.68975ef3.js"><link rel="prefetch" href="/docs-test/assets/js/29.fa1fee74.js"><link rel="prefetch" href="/docs-test/assets/js/3.197e5077.js"><link rel="prefetch" href="/docs-test/assets/js/30.2b935cca.js"><link rel="prefetch" href="/docs-test/assets/js/31.e176ae8a.js"><link rel="prefetch" href="/docs-test/assets/js/32.aeefd7f6.js"><link rel="prefetch" href="/docs-test/assets/js/4.2a5d96fc.js"><link rel="prefetch" href="/docs-test/assets/js/5.fd255a4a.js"><link rel="prefetch" href="/docs-test/assets/js/6.66b67ff0.js"><link rel="prefetch" href="/docs-test/assets/js/7.a0bf6ad6.js"><link rel="prefetch" href="/docs-test/assets/js/8.8cc2c738.js"><link rel="prefetch" href="/docs-test/assets/js/9.0d7158e2.js">
    <link rel="stylesheet" href="/docs-test/assets/css/0.styles.ad6f64d8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs-test/" class="home-link router-link-active"><img src="/docs-test/logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs-test/dev/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/docs-test/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs-test/dev/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/docs-test/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs-test/dev/" aria-current="page" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/docs-test/dev/payments" class="sidebar-heading clickable"><span>Payments</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/docs-test/dev/contracts/" class="sidebar-link">Smart contracts</a></li><li><a href="/docs-test/dev/bug-bounty.html" class="sidebar-link">Security Policy / Bug Bounty Program</a></li><li><a href="/docs-test/dev/nfts.html" aria-current="page" class="active sidebar-link">NFTs in zkSync 1.x</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs-test/dev/nfts.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs-test/dev/nfts.html#setup" class="sidebar-link">Setup</a></li><li class="sidebar-sub-header"><a href="/docs-test/dev/nfts.html#mint" class="sidebar-link">Mint</a></li><li class="sidebar-sub-header"><a href="/docs-test/dev/nfts.html#transfer" class="sidebar-link">Transfer</a></li><li class="sidebar-sub-header"><a href="/docs-test/dev/nfts.html#swap" class="sidebar-link">Swap</a></li><li class="sidebar-sub-header"><a href="/docs-test/dev/nfts.html#withdrawal-to-layer-1" class="sidebar-link">Withdrawal to Layer 1</a></li></ul></li><li><a href="/docs-test/dev/swaps.html" class="sidebar-link">Swaps and Limit Orders</a></li><li><a href="/docs-test/dev/events.html" class="sidebar-link">Watching events</a></li><li><a href="/docs-test/dev/test.html" class="sidebar-link">test</a></li><li><a href="/docs-test/dev/testdemo.html" class="sidebar-link">test demo</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nfts-in-zksync-1-x"><a href="#nfts-in-zksync-1-x" class="header-anchor">#</a> NFTs in zkSync 1.x</h1> <p>Support for NFTs on zkSync 1.x is here! Functions include minting, transferring, and atomically swapping NFTs. Users will also be able to withdraw NFTs to Layer 1.</p> <p>This page demonstrates how NFTs are implemented in zkSync 1.x and provides a tutorial for you to integrate NFTs into your project.</p> <ul><li><a href="#overview">Overview</a></li> <li><a href="#setup">Setup</a></li> <li><a href="#mint">Mint</a></li> <li><a href="#transfer">Transfer</a></li> <li><a href="#swap">Swap</a></li> <li><a href="#withdrawal-to-layer-1">Withdrawal to Layer 1</a></li></ul> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>NFT addresses will encode NFT content and metadata as follows:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>address <span class="token operator">=</span> <span class="token function">truncate_to_20_bytes</span><span class="token punctuation">(</span><span class="token function">rescue_hash</span><span class="token punctuation">(</span>creator_account_id <span class="token operator">||</span> serial_id <span class="token operator">||</span> content_hash<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>This cryptographically ensures two invariants:</p> <ul><li>NFT addresses serve as a unique commitment to the creator, serial number of the NFT, and its content hash.</li> <li>NFT addresses can not be controlled by anyone or have smart contract code on mainnet.</li></ul> <p>NOTICE: In zkSync 1.x, multiple NFTs can be minted with the same content hash.</p> <h2 id="setup"><a href="#setup" class="header-anchor">#</a> Setup</h2> <p>Please read our <a href="/docs-test/api/sdk/js/tutorial.html#getting-started">Getting Started</a> guide before beginning this tutorial.</p> <h3 id="install-the-zksync-library"><a href="#install-the-zksync-library" class="header-anchor">#</a> Install the zkSync library</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> zksync
</code></pre></div><h3 id="connect-to-zksync-network"><a href="#connect-to-zksync-network" class="header-anchor">#</a> Connect to zkSync network</h3> <p>For this tutorial, let's connect to the Rinkeby testnet. The steps for mainnet and Ropsten would be identical.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> syncProvider <span class="token operator">=</span> <span class="token keyword">await</span> zksync<span class="token punctuation">.</span><span class="token function">getDefaultProvider</span><span class="token punctuation">(</span><span class="token string">&quot;rinkeby&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mint"><a href="#mint" class="header-anchor">#</a> Mint</h2> <p>To mint an NFT, we will introduce a new opcode <code>MINT_NFT</code> with arguments:</p> <ul><li>creator_account_id</li> <li>content_hash</li> <li>recipient_account_id</li></ul> <p>By passing in <code>recipient_account_id</code>, we allow creators to choose whether to mint to themselves or directly to others.</p> <h3 id="enforcing-uniqueness"><a href="#enforcing-uniqueness" class="header-anchor">#</a> Enforcing Uniqueness</h3> <p>To enforce uniqueness of NFT <strong>token IDs</strong>, we use the last account in the zkSync balance tree to track token IDs. This account, which we will refer to as <code>SpecialNFTAccount</code>, will have a balance of <code>SPECIAL_NFT_TOKEN</code> representing the <code>token_id</code> of the latest mint.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// token ID is represented by:</span>
SpecialNFTAccount<span class="token punctuation">[</span><span class="token constant">SPECIAL_NFT_TOKEN</span><span class="token punctuation">]</span> 
<span class="token comment">// for every mint, we increment the token ID of the NFT account</span>
SpecialNFTAccount<span class="token punctuation">[</span><span class="token constant">SPECIAL_NFT_TOKEN</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
</code></pre></div><p>To enforce uniqueness of NFT <strong>token addresses</strong>, recall <code>serial_id</code> is an input in the hash that generates the address. Creator accounts will have a balance of <code>SPECIAL_NFT_TOKEN</code> representing the <code>serial_id</code>, the number of NFTs that have been minted by the creator.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// serial ID is represented by:</span>
CreatorAccount<span class="token punctuation">[</span><span class="token constant">SPECIAL_NFT_TOKEN</span><span class="token punctuation">]</span> 
<span class="token comment">// for every mint, we increment the serial ID of the creator account</span>
CreatorAccount<span class="token punctuation">[</span><span class="token constant">SPECIAL_NFT_TOKEN</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
</code></pre></div><p>zkSync servers will maintain a mapping of NFT token addresses to token IDs.</p> <h3 id="calculate-transaction-fee"><a href="#calculate-transaction-fee" class="header-anchor">#</a> Calculate Transaction Fee</h3> <p>To calculate the transaction fee for minting an NFT, you can use the <code>getTransactionFee</code> method from the <code>Provider</code> class.</p> <blockquote><p>Signature</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token function">getTransactionFee</span><span class="token punctuation">(</span>
    txType<span class="token operator">:</span> <span class="token string">'Withdraw'</span> <span class="token operator">|</span> <span class="token string">'Transfer'</span> <span class="token operator">|</span> <span class="token string">'FastWithdraw'</span> <span class="token operator">|</span> <span class="token string">'MintNFT'</span> <span class="token operator">|</span> ChangePubKeyFee <span class="token operator">|</span> LegacyChangePubKeyFee<span class="token punctuation">,</span>
    address<span class="token operator">:</span> Address<span class="token punctuation">,</span>
    tokenLike<span class="token operator">:</span> TokenLike
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Fee<span class="token operator">&gt;</span>
</code></pre></div><p>Example:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> totalFee<span class="token operator">:</span> fee <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> syncProvider<span class="token punctuation">.</span><span class="token function">getTransactionFee</span><span class="token punctuation">(</span><span class="token string">&quot;MintNFT&quot;</span><span class="token punctuation">,</span> syncWallet<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> feeToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mint-the-nft"><a href="#mint-the-nft" class="header-anchor">#</a> Mint the NFT</h3> <p>You can mint an NFT by calling the <code>mintNFT</code> function from the <code>Wallet</code> class.</p> <blockquote><p>Signature</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token function">mintNFT</span><span class="token punctuation">(</span>mintNft<span class="token operator">:</span> <span class="token punctuation">{</span>
    recipient<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    contentHash<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    feeToken<span class="token operator">:</span> TokenLike<span class="token punctuation">;</span>
    fee<span class="token operator">?</span><span class="token operator">:</span> BigNumberish<span class="token punctuation">;</span>
    nonce<span class="token operator">?</span><span class="token operator">:</span> Nonce<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>recipient</td> <td>the recipient address represented as a hex string</td></tr> <tr><td>contentHash</td> <td>the unique identifier of the NFT represented as a 32-byte hex string (e.g. IPFS content identifier)</td></tr> <tr><td>feeToken</td> <td>name of token in which fee is to be paid (typically ETH)</td></tr> <tr><td>fee</td> <td>transaction fee</td></tr></tbody></table> <p>Example:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> contentHash <span class="token operator">=</span> <span class="token string">&quot;0xbd7289936758c562235a3a42ba2c4a56cbb23a263bb8f8d27aead80d74d9d996&quot;</span>
<span class="token keyword">const</span> nft <span class="token operator">=</span> <span class="token keyword">await</span> syncWallet<span class="token punctuation">.</span><span class="token function">mintNFT</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    recipient<span class="token operator">:</span> syncWallet<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    contentHash<span class="token punctuation">,</span>
    feeToken<span class="token operator">:</span> <span class="token string">&quot;ETH&quot;</span><span class="token punctuation">,</span>
    fee<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="get-a-receipt"><a href="#get-a-receipt" class="header-anchor">#</a> Get a Receipt</h3> <p>To get a receipt for the minted NFT:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> receipt <span class="token operator">=</span> <span class="token keyword">await</span> nft<span class="token punctuation">.</span><span class="token function">awaitReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="view-the-nft"><a href="#view-the-nft" class="header-anchor">#</a> View the NFT</h3> <p>After an NFT is minted, it can be in two states: committed and verified. An NFT is committed if it has been included in a rollup block, and verified when a zero knowledge proof has been generated for that block and the root hash of the rollup block has been included in the smart contract on Ethereum mainnet.</p> <p>To view an account's NFTs:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// Get state of account</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">await</span> syncWallet<span class="token punctuation">.</span><span class="token function">getAccountState</span><span class="token punctuation">(</span><span class="token string">'&lt;account-address&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// View committed NFTs</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>committed<span class="token punctuation">.</span>nfts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// View verified NFTs</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>verified<span class="token punctuation">.</span>nfts<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You may also find the <code>getNFT</code> function from the <code>Wallet</code> class useful.</p> <blockquote><p>Signature</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token function">getNFT</span><span class="token punctuation">(</span>tokenId<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'committed'</span> <span class="token operator">|</span> <span class="token string">'verified'</span> <span class="token operator">=</span> <span class="token string">'committed'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">NFT</span><span class="token operator">&gt;</span>
</code></pre></div><h2 id="transfer"><a href="#transfer" class="header-anchor">#</a> Transfer</h2> <p>Users can transfer NFTs to existing accounts and transfer to addresses that have not yet registered a zkSync account. <code>TRANSFER</code> and <code>TRANSFER_TO_NEW</code> opcodes will work the same.</p> <p>An NFT can only be transferred after the block with it's mint transaction is verified. This means the newly minted NFT may have to wait a few hours before it can be transferred. This only applies to the first transfer; all following transfers can be completed with no restrictions.</p> <p>You can transfer an NFT by calling the <code>syncTransferNFT</code> function:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token function">syncTransferNFT</span><span class="token punctuation">(</span>transfer<span class="token operator">:</span> <span class="token punctuation">{</span>
    to<span class="token operator">:</span> Address<span class="token punctuation">;</span>
    token<span class="token operator">:</span> <span class="token constant">NFT</span><span class="token punctuation">;</span>
    feeToken<span class="token operator">:</span> TokenLike<span class="token punctuation">;</span>
    fee<span class="token operator">?</span><span class="token operator">:</span> BigNumberish<span class="token punctuation">;</span>
    nonce<span class="token operator">?</span><span class="token operator">:</span> Nonce<span class="token punctuation">;</span>
    validFrom<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    validUntil<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Transaction<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>to</td> <td>the recipient address represented as a hex string</td></tr> <tr><td>feeToken</td> <td>name of token in which fee is to be paid (typically ETH)</td></tr> <tr><td>token</td> <td>NFT object</td></tr> <tr><td>fee</td> <td>transaction fee</td></tr></tbody></table> <p>The <code>syncTransferNFT</code> function works as a batched transaction under the hood, so it will return an array of transactions where the first handle is the NFT transfer and the second is the fee.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> handles <span class="token operator">=</span> <span class="token keyword">await</span> sender<span class="token punctuation">.</span><span class="token function">syncTransferNFT</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  to<span class="token operator">:</span> receiver<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  feeToken<span class="token punctuation">,</span>
  token<span class="token operator">:</span> nft<span class="token punctuation">,</span>
  fee<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="get-a-receipt-2"><a href="#get-a-receipt-2" class="header-anchor">#</a> Get a Receipt</h3> <p>To get a receipt for the transfer:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> receipt <span class="token operator">=</span> <span class="token keyword">await</span> handles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">awaitReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="swap"><a href="#swap" class="header-anchor">#</a> Swap</h2> <p>The swap function can be used to atomically swap:</p> <ol><li>one NFT for another NFT</li> <li>one NFT for fungible tokens (buying the NFT)</li></ol> <h3 id="swap-nfts"><a href="#swap-nfts" class="header-anchor">#</a> Swap NFTs</h3> <p>To swap 2 NFTs, each party will sign an order specifying the NFT ids for the NFT they are selling and the NFT they are buying.</p> <p>Using the <a href="/docs-test/api/sdk/js/accounts.html#signing-orders"><code>getOrder</code></a> method:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token keyword">await</span> wallet<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tokenSell<span class="token operator">:</span> myNFT<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    tokenBuy<span class="token operator">:</span> anotherNFT<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    amount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    ratio<span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token function">tokenRatio</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token punctuation">[</span>myNFT<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>anotherNFT<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Note: when performing an NFT to NFT swap, the ratios will always be set to one.</p> <p>After 2 orders are signed, anyone can initiate the swap by calling the <a href="/docs-test/api/sdk/js/accounts.html#submitting-a-swap"><code>syncSwap</code></a> method:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// whoever initiates the swap pays the fee</span>
<span class="token keyword">const</span> swap <span class="token operator">=</span> <span class="token keyword">await</span> submitter<span class="token punctuation">.</span><span class="token function">syncSwap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    orders<span class="token operator">:</span> <span class="token punctuation">[</span>orderA<span class="token punctuation">,</span> orderB<span class="token punctuation">]</span><span class="token punctuation">,</span>
    feeToken<span class="token operator">:</span> <span class="token string">'ETH'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To get a receipt:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> receipt <span class="token operator">=</span> <span class="token keyword">await</span> swap<span class="token punctuation">.</span><span class="token function">awaitReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="buy-sell-nfts"><a href="#buy-sell-nfts" class="header-anchor">#</a> Buy / Sell NFTs</h3> <p>To buy or sell an NFT for fungible tokens, each party will sign an order specifying the NFT id and the name of the token they are spending/receiving. In the example, pay special attention to the ratio parameter. You can find a list of available tokens and their symbols in our <a href="https://zkscan.io/explorer/tokens" target="_blank" rel="noopener noreferrer">explorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> buyingNFT <span class="token operator">=</span> <span class="token keyword">await</span> walletA<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tokenBuy<span class="token operator">:</span> nft<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    tokenSell<span class="token operator">:</span> <span class="token string">'USDT'</span><span class="token punctuation">,</span>
    amount<span class="token operator">:</span> tokenSet<span class="token punctuation">.</span><span class="token function">parseToken</span><span class="token punctuation">(</span><span class="token string">'USDT'</span><span class="token punctuation">,</span> <span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ratio<span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token function">tokenRatio</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token constant">USDT</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>nft<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sellingNFT <span class="token operator">=</span> <span class="token keyword">await</span> walletB<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tokenBuy<span class="token operator">:</span> <span class="token string">'USDT'</span><span class="token punctuation">,</span>
    tokenSell<span class="token operator">:</span> nft<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    amount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    ratio<span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token function">tokenRatio</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token constant">USDT</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>nft<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="withdrawal-to-layer-1"><a href="#withdrawal-to-layer-1" class="header-anchor">#</a> Withdrawal to Layer 1</h2> <p>Withdrawals to L1 will require 3 actors:</p> <ul><li>Factory: L1 contract that can mint L1 NFT tokens</li> <li>Creator: user which <em>mints</em> NFT on L2</li> <li>NFTOwner: user which <em>owns</em> NFT on L2</li></ul> <p>This guide will demonstrate 2 types of withdrawals: normal and emergency, and explain under what conditions each type should be used. It also explains the architecture of the NFT token bridge between zkSync and L1, and what is needed if protocols want to implement their own NFT factory contract on L1.</p> <h3 id="withdraw-nft"><a href="#withdraw-nft" class="header-anchor">#</a> Withdraw NFT</h3> <p>Under normal conditions use a layer 2 operation, <code>withdrawNFT</code>, to withdraw the NFT.</p> <blockquote><p>Signature</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">withdrawNFT</span><span class="token punctuation">(</span>withdrawNFT<span class="token operator">:</span> <span class="token punctuation">{</span>
    to<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    token<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    feeToken<span class="token operator">:</span> TokenLike<span class="token punctuation">;</span>
    fee<span class="token operator">?</span><span class="token operator">:</span> BigNumberish<span class="token punctuation">;</span>
    nonce<span class="token operator">?</span><span class="token operator">:</span> Nonce<span class="token punctuation">;</span>
    fastProcessing<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    validFrom<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    validUntil<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>to</td> <td>L1 recipient address represented as a hex string</td></tr> <tr><td>feeToken</td> <td>name of token in which fee is to be paid (typically ETH)</td></tr> <tr><td>token</td> <td>id of the NFT</td></tr> <tr><td>fee</td> <td>transaction fee</td></tr> <tr><td>fastProcessing</td> <td>pay additional fee to complete block immediately, skip waiting for other transactions to fill the block</td></tr></tbody></table> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> withdraw <span class="token operator">=</span> <span class="token keyword">await</span> wallet<span class="token punctuation">.</span><span class="token function">withdrawNFT</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    to<span class="token punctuation">,</span>
    token<span class="token punctuation">,</span>
    feeToken<span class="token punctuation">,</span>
    fee<span class="token punctuation">,</span>
    fastProcessing
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Get the receipt:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> receipt <span class="token operator">=</span> <span class="token keyword">await</span> withdraw<span class="token punctuation">.</span><span class="token function">awaitReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="emergency-withdraw"><a href="#emergency-withdraw" class="header-anchor">#</a> Emergency Withdraw</h3> <p>In case of censorship, users may call for an emergency withdrawal. Note: This is a layer 1 operation, and is analogous to our <a href="https://zksync.io/dev/payments/basic.html#withdrawing-funds" target="_blank" rel="noopener noreferrer">fullExit mechanism<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <blockquote><p>Signature</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token function">emergencyWithdraw</span><span class="token punctuation">(</span>withdraw<span class="token operator">:</span> <span class="token punctuation">{</span>
        token<span class="token operator">:</span> TokenLike<span class="token punctuation">;</span>
        accountId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
        ethTxOptions<span class="token operator">?</span><span class="token operator">:</span> ethers<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>TransactionRequest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ETHOperation<span class="token operator">&gt;</span>
</code></pre></div><table><thead><tr><th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>token</td> <td>id of the NFT</td></tr> <tr><td>accountId (Optional)</td> <td>account id for fullExit</td></tr></tbody></table> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> emergencyWithdrawal <span class="token operator">=</span> <span class="token keyword">await</span> wallet<span class="token punctuation">.</span><span class="token function">emergencyWithdraw</span><span class="token punctuation">(</span><span class="token punctuation">{</span> token<span class="token punctuation">,</span> accountId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> receipt <span class="token operator">=</span> <span class="token keyword">await</span> emergencyWithdrawal<span class="token punctuation">.</span><span class="token function">awaitReceipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="factory-and-zksync-smart-contract-interaction"><a href="#factory-and-zksync-smart-contract-interaction" class="header-anchor">#</a> Factory and zkSync Smart Contract Interaction</h3> <p>We have a default factory contract that will handle minting NFTs on L1 for projects that do not want to implement their own minting contract. Projects with their own minting contracts only need to implement one minting function: <code>mintNFTFromZkSync</code>.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">mintNFTFromZkSync</span><span class="token punctuation">(</span>creator_address<span class="token operator">:</span> address<span class="token punctuation">,</span> creator_id<span class="token operator">:</span> uint32<span class="token punctuation">,</span> serial_id<span class="token operator">:</span> uint32<span class="token punctuation">,</span> content_hash<span class="token operator">:</span> bytes<span class="token punctuation">,</span> recipient_address<span class="token operator">:</span> address<span class="token punctuation">,</span> token_id<span class="token operator">:</span> uint32<span class="token punctuation">)</span>
</code></pre></div><p>The zkSync Governance contract will implement a function <code>registerFactory</code> that will register creators as a trusted minter on L2 for the factory contract.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">registerFactory</span><span class="token punctuation">(</span>creator_address<span class="token operator">:</span> address<span class="token punctuation">,</span> signature<span class="token operator">:</span> bytes<span class="token punctuation">)</span>
</code></pre></div><p>To withdraw, users call <code>withdrawNFT()</code> with the token_id. The zkSync smart contract will verify ownership, burn the token on L2, and call <code>mintNFTFromZkSync</code> on the factory corresponding to the creator.</p> <h3 id="factory-registration"><a href="#factory-registration" class="header-anchor">#</a> Factory Registration</h3> <ol><li>To register a factory, creators will sign the following message with data <code>factory_address</code> and <code>creator_address</code>.</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&quot;\x19Ethereum Signed Message:\n141&quot;,
&quot;\nCreator's account ID in zkSync: {creatorIdInHex}&quot;,
&quot;\nCreator: {CreatorAddressInHex}&quot;,
&quot;\nFactory: {FactoryAddressInHex}&quot;
</code></pre></div><ol start="2"><li>The factory contract calls <code>registerFactory</code> on the zkSync L1 smart contract with the signature.</li> <li>zkSync smart contract validates the signature and emits an event with <code>factory_address</code> and <code>creator_address</code>.</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs-test/dev/bug-bounty.html" class="prev">
        Security Policy / Bug Bounty Program
      </a></span> <span class="next"><a href="/docs-test/dev/swaps.html">
        Swaps and Limit Orders
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs-test/assets/js/app.61e6e887.js" defer></script><script src="/docs-test/assets/js/2.25e5da35.js" defer></script><script src="/docs-test/assets/js/12.a9d36d9e.js" defer></script>
  </body>
</html>
