(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{380:function(t,a,s){"use strict";s.r(a);var e=s(45),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"swaps-and-limit-orders"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swaps-and-limit-orders"}},[t._v("#")]),t._v(" Swaps and Limit Orders")]),t._v(" "),s("h2",{attrs:{id:"atomic-swaps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#atomic-swaps"}},[t._v("#")]),t._v(" Atomic swaps")]),t._v(" "),s("p",[t._v("Atomic swaps let you safely and cheaply swap funds with an existing zkSync account.")]),t._v(" "),s("p",[t._v("There are 3 steps required to successfully make a swap:")]),t._v(" "),s("ul",[s("li",[t._v("Sign an order that confirms that you want perform a certain swap")]),t._v(" "),s("li",[t._v("Acquire a signed order of the same format from the account that you want to swap with")]),t._v(" "),s("li",[t._v("Submit both orders with a fee to the zkSync server")])]),t._v(" "),s("h3",{attrs:{id:"signing-an-order"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#signing-an-order"}},[t._v("#")]),t._v(" Signing an order")]),t._v(" "),s("p",[t._v("To sign an order, you need the following info:")]),t._v(" "),s("ul",[s("li",[t._v("token you want to swap")]),t._v(" "),s("li",[t._v("token you want to swap for")]),t._v(" "),s("li",[t._v("amount of the token that you want to swap")]),t._v(" "),s("li",[t._v("ratio of the swapped tokens, relevant to one another")])]),t._v(" "),s("p",[t._v("Ratios are 15-byte integers that represent the proportion in which tokens are swapped.")]),t._v(" "),s("p",[t._v("To sign an order, use the "),s("RouterLink",{attrs:{to:"/api/sdk/js/accounts.html#signing-orders"}},[s("code",[t._v("getOrder")])]),t._v(" method of "),s("code",[t._v("Wallet")]),t._v(":")],1),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" wallet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    tokenSell"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    tokenBuy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'USDT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    amount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" tokenSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2.5'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ratio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenRatio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ETH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USDT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'4234.5'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("An order can also include:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("recipient")]),t._v(" - an address of an existing account, to which the result of a swap should be transferred, in case you want to perform a swap-and-transfer. Defaults to self")]),t._v(" "),s("li",[s("code",[t._v("validFrom")]),t._v(" and "),s("code",[t._v("validUntil")]),t._v(" Unix timestamps which limit a timespan where a block with a swap can be processed")]),t._v(" "),s("li",[s("code",[t._v("nonce")]),t._v(" that is going to be used for the swap")])]),t._v(" "),s("h3",{attrs:{id:"submitting-a-swap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#submitting-a-swap"}},[t._v("#")]),t._v(" Submitting a swap")]),t._v(" "),s("p",[t._v("Anyone can submit 2 orders for a swap if they meet the following limitations:")]),t._v(" "),s("ul",[s("li",[t._v("orders have matching tokens: if "),s("code",[t._v("orderA")]),t._v(" specifies "),s("code",[t._v("tokenA -> tokenB")]),t._v(", then "),s("code",[t._v("orderB")]),t._v(" should specify "),s("code",[t._v("tokenB -> tokenA")])]),t._v(" "),s("li",[t._v("ratios in orders are compatible: "),s("code",[t._v("1/orderB.ratio <= orderA.amount/orderB.amount <= orderA.ratio")])]),t._v(" "),s("li",[t._v("if orders have recipients, their accounts already exist in zkSync")])]),t._v(" "),s("p",[t._v("Fee is paid by the submitter, and the token it is paid in should be specified.\nAfter a swap is executed, nonce is incremented on both swapping accounts and the submitter.\nIf swap was submitted from one of the swapping accounts, nonce is incremented only once.")]),t._v(" "),s("p",[t._v("If the user wishes to cancel the swap that has not yet been submitted, they simply have to increment their nonce (e.g. send a zero-transfer).")]),t._v(" "),s("p",[t._v("To submit a swap, use the "),s("RouterLink",{attrs:{to:"/api/sdk/js/accounts.html#submitting-a-swap"}},[s("code",[t._v("syncSwap")])]),t._v(" method of "),s("code",[t._v("Wallet")]),t._v(":")],1),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" swap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" wallet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("syncSwap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    orders"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("orderA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" orderB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    feeToken"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wBTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"limit-orders"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#limit-orders"}},[t._v("#")]),t._v(" Limit orders")]),t._v(" "),s("p",[t._v("Limit orders provide a way to exchange a certain token for another at a certain price.\nThey are designed to be used primarily by other platforms that want to provide trustless and scalable exchange services.")]),t._v(" "),s("p",[t._v("The differences between an atomic swap and a limit order are:")]),t._v(" "),s("ul",[s("li",[t._v("limit orders infer the amount that can be exchanged directly from the balance")]),t._v(" "),s("li",[t._v("limit orders can be partially filled")]),t._v(" "),s("li",[t._v("limit orders do not increment account's nonce when partially filled")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("This means that once a limit order is signed for a certain token, the whole balance can potentially be exchanged for another token (at a specified ratio).\nThere is no way to limit the amount to be exchanged other than use a special trading account.")])]),t._v(" "),s("h3",{attrs:{id:"trading-accounts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#trading-accounts"}},[t._v("#")]),t._v(" Trading accounts")]),t._v(" "),s("p",[t._v("A trading account is an ordinary account that can be used to sign a limit order.\nIt's function is to limit the amount of a certain token that a user wants to exchange.")]),t._v(" "),s("p",[t._v("To do this, user has to:")]),t._v(" "),s("ol",[s("li",[t._v("Transfer the desired amount of a desired token to a new account.")]),t._v(" "),s("li",[t._v("Set a signing key for the account.")]),t._v(" "),s("li",[t._v("Sign a limit order.")])]),t._v(" "),s("p",[t._v("This way the limit order will exchange at most the amount you transferred to the trading account.\nRemaining balance on the main account will be left untouched.")]),t._v(" "),s("h3",{attrs:{id:"signing-limit-orders"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#signing-limit-orders"}},[t._v("#")]),t._v(" Signing limit orders")]),t._v(" "),s("p",[t._v("To sign a limit order, use the "),s("RouterLink",{attrs:{to:"/api/sdk/js/accounts.html#signing-orders"}},[s("code",[t._v("getLimitOrder")])]),t._v(" method of "),s("code",[t._v("Wallet")]),t._v(":")],1),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" order "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" wallet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLimitOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    tokenSell"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    tokenBuy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'USDT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ratio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenRatio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ETH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USDT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3900")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"filling-a-limit-order"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filling-a-limit-order"}},[t._v("#")]),t._v(" Filling a limit order")]),t._v(" "),s("p",[t._v("Limit order itself represents only a half of the swap operation. In order to be filled, the following criteria must be met:")]),t._v(" "),s("ul",[s("li",[t._v("There exists a counterpart order (a normal order "),s("em",[t._v("or")]),t._v(" a limit order) that fits the original order's tokens and buy/sell ratio.")]),t._v(" "),s("li",[t._v("There exists someone willing to combine both orders into a swap operation and submit it.")])]),t._v(" "),s("p",[t._v("Amounts that are being filled should be specified in the swap operation.\nLimit orders can be partially filled, so amounts can be different from actual balances,\nalthough must be compatible with the ratios specified in the orders. For details, see "),s("a",{attrs:{href:"#example"}},[t._v("example")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" swap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" wallet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("syncSwap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    orders"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("orderA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" orderB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    amounts"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        tokenSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        tokenSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UDST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'7800'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    feeToken"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wBTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"note-on-limit-order-matching"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#note-on-limit-order-matching"}},[t._v("#")]),t._v(" Note on limit order matching")]),t._v(" "),s("p",[t._v("Performing atomic swaps is as simple as sharing a signed order message with a party that you want to swap with.")]),t._v(" "),s("p",[t._v("On the other hand, collecting and matching limit orders should probably be performed by platform(s)\nwith an already existing userbase by some kind of matching engine. zkSync tries to be as generic as possible,\nso creating matching engines is not considered - we will only provide an L2 framework that other platforms can integrate with.")]),t._v(" "),s("h3",{attrs:{id:"suggestions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#suggestions"}},[t._v("#")]),t._v(" Suggestions")]),t._v(" "),s("p",[t._v("Trading accounts can be created as CREATE2 accounts. This approach has the following benefits:")]),t._v(" "),s("ul",[s("li",[t._v("Setting a signing key on a CREATE2 account is cheaper")]),t._v(" "),s("li",[t._v("Salt argument in CREATE2 can be used to deterministically generate trading account addresses for a certain main account")]),t._v(" "),s("li",[t._v("Same L2 private key can be used for all trading accounts and the main account if desired.\nAlthough this bears some risks (compromising a single account would mean compromising all of them), key management can be inconvenient in some situations.")])]),t._v(" "),s("p",[t._v("Should a platform decide to use CREATE2 for trading accounts, it will have to choose a contract bytecode to be used for address calculation.\nThe contract should be open-source and have full exit and withdrawal functionality since in the rare case of censorship users will have to deploy it to rescue their funds.")]),t._v(" "),s("p",[t._v("It is also suggested to reuse trading accounts on which orders were filled or cancelled since this way a signing key would not have to be set again.")]),t._v(" "),s("h3",{attrs:{id:"example"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[t._v("#")]),t._v(" Example")]),t._v(" "),s("p",[t._v("This section provides an example of how ratios specified in orders affect account balances.")]),t._v(" "),s("p",[t._v("Let the swap consist of 2 limit orders:")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// walletA wants to swap wBTC for ETH at a ratio 2:5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" orderA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" walletA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLimitOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    tokenSell"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wBTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    tokenBuy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ratio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenRatio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        wBTC"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ETH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// walletB wants to swap ETH for wBTC at a ratio 4:1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" orderB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" walletB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLimitOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    tokenSell"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    tokenBuy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wBTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ratio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenRatio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        wBTC"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ETH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Specified ratios mean that:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("walletA")]),t._v(" expects to get 2.5 ETH for each wBTC (or more)")]),t._v(" "),s("li",[s("code",[t._v("walletB")]),t._v(" expects to get 0.25 wBTC for each ETH (or more)")])]),t._v(" "),s("p",[t._v("Ratios are compatible, because at either ratio (or in between), both parties will be happy:")]),t._v(" "),s("ul",[s("li",[t._v("at "),s("code",[t._v("orderB")]),t._v("'s ratio "),s("code",[t._v("walletA")]),t._v(" will get 4 ETH per wBTC, which is more than expected")]),t._v(" "),s("li",[t._v("at "),s("code",[t._v("orderA")]),t._v("'s ratio "),s("code",[t._v("walletB")]),t._v(" will get 0.4 wBTC per ETH, which is more than expected")])]),t._v(" "),s("p",[t._v("Now let's actually submit the swap, and pick a ratio in between - 3 ETH per wBTC:")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" swap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" walletC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("syncSwap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    orders"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("orderA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" orderB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    amounts"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        tokenSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wBTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        tokenSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'300'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    feeToken"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'USDT'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("This will exchange 100 wBTC from "),s("code",[t._v("walletA")]),t._v(" for 300 ETH from "),s("code",[t._v("walletB")]),t._v(". For detailed information, see table below.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th"),t._v(" "),s("th",[s("code",[t._v("walletA")])]),t._v(" "),s("th",[s("code",[t._v("walletB")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("wBTC before swap")]),t._v(" "),s("td",[t._v("100")]),t._v(" "),s("td",[t._v("0")])]),t._v(" "),s("tr",[s("td",[t._v("ETH before swap")]),t._v(" "),s("td",[t._v("0")]),t._v(" "),s("td",[t._v("300")])]),t._v(" "),s("tr",[s("td",[t._v("ETH expected after swap")]),t._v(" "),s("td",[t._v("0")]),t._v(" "),s("td",[t._v("75")])]),t._v(" "),s("tr",[s("td",[t._v("wBTC expected after swap")]),t._v(" "),s("td",[t._v("250")]),t._v(" "),s("td",[t._v("0")])]),t._v(" "),s("tr",[s("td",[t._v("ETH actually after swap")]),t._v(" "),s("td",[t._v("0")]),t._v(" "),s("td",[t._v("100")])]),t._v(" "),s("tr",[s("td",[t._v("wBTC actually after swap")]),t._v(" "),s("td",[t._v("300")]),t._v(" "),s("td",[t._v("0")])])])]),t._v(" "),s("h2",{attrs:{id:"utils"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utils"}},[t._v("#")]),t._v(" Utils")]),t._v(" "),s("p",[t._v("To construct a ratio, use either of the two utility functions:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("tokenRatio")]),t._v(" constructs a ratio relevant to the tokens themselves,\nso "),s("code",[t._v("{ ETH: 4, wBTC: 1 }")]),t._v(" would mean you want 4 ETH for each wBTC.")]),t._v(" "),s("li",[s("code",[t._v("weiRatio")]),t._v(" constructs a ratio relevant to the "),s("em",[t._v("lowest denomination")]),t._v(" of the token,\nso "),s("code",[t._v("{ ETH: 4, wBTC: 1 }")]),t._v(" would mean you want 4 wei (10"),s("sup",[t._v("-18")]),t._v(" ETH) for each satoshi (10"),s("sup",[t._v("-8")]),t._v(" wBTC).")])]),t._v(" "),s("p",[t._v("If tokens symbols or IDs are contained in variables, use the following syntax to pass them into ratio objects:")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[t._v("utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenRatio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("tokenA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" valueA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("tokenB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" valueB\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("For more information, visit the "),s("RouterLink",{attrs:{to:"/api/sdk/js/accounts.html#ratios"}},[t._v("API reference")]),t._v(".")],1)])}),[],!1,null,null,null);a.default=n.exports}}]);